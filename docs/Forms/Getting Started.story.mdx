import { Meta } from '@storybook/addon-docs'

<Meta title="Cactus Form/Getting Started" />

# Getting Started

Collecting data using forms is one of the most basic functions of a website. <a to='/components/'>@repay/cactus-web</a> provides several styled form inputs, as well as a few custom inputs that emulate built-in HTML inputs. 
This guide will show you the basics of combining these input components with a common forms library, [Final Form](https://final-form.org/).
Note that because Final Form is framework-agnostic, there's [another library](https://final-form.org/react) for the React-specific parts.

Before starting with Cactus Form, you should have a React application, and know how to add a page or component.

### Installation

Installation is simple enough, just add the latest version of "@repay/cactus-form" to the `dependencies` list in your package.json (or however you add dependencies in your particular project).

Cactus Form also has an optional setup step using [patch-package](https://www.npmjs.com/package/patch-package), described in more depth [below](#patching-react-final-form).

Note that Cactus Form also exports final-form and react-final-form features that have not been edited to keep everything in one place. It should cover the vast majority of use cases but "final-form", "react-final-form" can still be imported separately for the original version of `Field`, `Form`, or if there's an uncommon feature that you need.

## Using React Final Form

The basic Final Form library is very flexible, and we highly recommend going through the docs to understand what it's capable of. However, the majority of use cases can be covered by the components in React Final Form and Cactus Form.

To make a form you start with the [Form](/docs/cactus-form-components-form--page) component,
which creates both a form and a React context that allows you to access it from any descendants.
Once the form is created, there are a variety of hooks and components that can be used to implement the functionality.
We won't be getting into all the arguments and subtleties since those are well-covered in the documentation,
just covering enough to show how it works with Cactus components.

Creating a form is simple:

```jsx
import { Field, Form, FormSpy, SubmitButton } from '@repay/cactus-form'
import { Button } from '@repay/cactus-web'
import React from 'react'

const ExampleForm = (props) => (
  <Form {...props}>
        <FormSpy subscription={{ error: true }}>
          {({error}) => (
            <Alert status="error">{error}</Alert>
          )}
        </FormSpy>
        <Field id="text-input" name="mytext" label="Enter some text" />
        <Field type="checkbox" name="mycb" label="Check me (or don't)" />
        <SubmitButton />
  </Form>
)
```

The Cactus Form version of `Field` automatically maps `type` to Cactus Web components:
the example above will render a `TextInputField` and a `CheckBoxField`,
but this behavior is customizable in a number of ways, covered more in the Field docs.


## Patching React Final Form

Cactus Form should work fine out of the box, but there are a couple of issues
with certain Cactus components and common design patterns:

- React Final Form doesn't work with CheckBoxGroup/CheckBoxCard.Group & array values (i.e. multiple checkboxes with the same name); you have to wrap each checkbox individually, and pass `type="checkbox"` on each one.
- With both checkbox groups and radio groups, React Final Form emits a warning that you need to pass `type="checkbox"` (or "radio"), but if you actually do so it will give the wrong checked/value props to the group component.
- We often put fields into Accordions that can be re-ordered, e.g. when there's a repeatable subset of fields on the form. However, Accordion only renders its child fields when it's open, and the mutators in `final-form-arrays` are not compatible with `react-final-form` unless the source and destination fields being reordered are both rendered on the page.

To work around these issues, we provide a patch that can be applied using [patch-package](https://www.npmjs.com/package/patch-package).
Because this is a library we can't just apply the patch automatically, so it takes a couple of extra steps:

1. Make sure you have `patch-package` in `devDependencies` or `dependencies`.
2. Add the following to your `package.json`:

```
"scripts": {
  "postinstall": "patch-package --patch-dir=node_modules/@repay/cactus-form/dist"
}
```

Or, if you already use `patch-package` in your project, you may need to run it twice:

```
"scripts": {
  "postinstall": "patch-package && patch-package --patch-dir=node_modules/@repay/cactus-form/dist"
}
```
